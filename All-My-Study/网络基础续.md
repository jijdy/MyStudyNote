1. 概述
   1. 五层协议
      * 应用层：为程序提供数据传输服务，HTTP，DNS协议，数据单位为报文
      * 传输层：为进程提供通用数据传输服务。TCP传输控制协议，提供可靠的数据连接，数据单位为报文段；UDP用户数据报协议，提供无连接，尽最大努力的数据传输。数据单位为用户数据报。TCP传输更加安全和能够保证数据的完整，但速度不能保证；UDP主要提供速度的及时性，但安全性能较低。
      * 网络层：为主机提供数据传输服务。将从传输层接收到的报文段或者用户数据报封装为分组。
      * 数据链路层：主机间可以有很多链路，数据链路层为同一链路的主机提供传输服务。将从网络层传下来的分组封装为帧。
      * 物理层：指怎样在传输媒体上传输数据比特流，而不是值具体的传输媒体。
   2. OSI七层协议：在应用层下的两层，一般由程序员来实现
      * 表示层：数据压缩，加密和数据描述，使得应用程序不必过度关心数据格式
      * 会话层：建立和管理会话。
   3. 其他：路由器因为不需要提供服务和传输，所以只有五层协议中的下三层

#### 具体层协议和作用

1. 物理层：略

2. 链路层：将从网络层传下来的分组(IP数据报)添加首部和尾部，用于标记帧的开始和结束
   * CSMA/CD协议：表示载波监听多点接入 / 碰撞检测。
   * PPP协议：用于在用户计算机和ISP进行通信的数据链路层协议，以便用户可以通过ISP进行连接互联网
   * MAC地址，是链路层地址，长度为6字节，用于唯一标识网络适配器(网卡)的地址。
   
3. 网络层：是整个互联网的核心，使用IP地址来讲多个物理主机连接为网络

   * IP协议：分别有IPV4和IPV6两种形式，
   * ARP地址解析协议：主机间通信时，IP地址代表唯一的主机编号，但是不同的链路层有不同的MAC地址，所以ARP协议用于解析在IP地址中的MAC地址，通过ARP高速缓存实现。
   * ICMP网络控制包文协议：ICMP 是为了更有效地转发 IP 数据报和提高交付成功的机会。它封装在 IP 数据报中，但是不属于高层协议。
     * Ping：是ICMP的一个重要应用，用于测试两台主机间的连通性，发送Echo请求报文和答文。

4. 传输层：网络层只将分组发送到主机，但真正要进行通信的是主机间的进程，传输层就是在屏蔽了底层实现的基础上提供了各个主机间进程的逻辑通信方法。

   * UDP用户数据报协议：是无连接的，尽最大可能交付，没有拥塞控制，面向报文，支持一对/一多的交互通信。

     * 因为没有参数校验，所以不能够保证数据在传输过程中的完整性，现在大多已经不再互联网应用中使用。

   * TCP传输控制协议：是面向连接的，通过可靠交付，有流量控制，拥塞控制，通过全双工通信，面向字节流，只支持一对一的连接交互。

     * TCP的三次握手和四次挥手。。。

     * TCP的可靠传输：依靠超时重传来实现，若已经发送的报文段在超过时限时候没有收到确认，则会从这个超时的报文段开始重新发送报文段。

     * TCP滑动窗口：窗口是缓存的一部分，用于暂时存放字节流。

       1. 接收方首先通过TCP报文中的窗口字段将自己的窗口大小告诉发送方，发送方根据这个值设置发送的窗口大小。
       2. 在收到一段窗口的字节流后会返回窗口数据给发送方，若为按顺序收到则不会发生收到信号，需要发送方等待超时后再次重新发送。

     * TCP流量控制：在滑动窗口进行时，接收方通过确认报文中的窗口字段设置发送方的窗口大小，从而控制流量速率。若窗口字段为0，则发送方不能发送数据。

     * TCP拥塞控制：若网络出现拥塞，分组会丢失，但和流量控制不同很想，但出发点不同。流量控制是为了让接收方能来得及接收，取决于接收方的窗口缓存；而拥塞控制是在网络拥塞时由发送方主动进行控制的。

       * 发送方通过维护一个拥塞窗口(cwnd)的状态变量，来控制发送的窗口速率。设置一个慢启动阈值ssthresh来控制其倍增上限/拥塞避免下限。

       1. 慢开始和拥塞避免：最初开始发送数据时慢开始，即cwnd = 1，发送方异常发送一个报文段，收到确认后，cwnd加倍，增长速度很快，直到cwnd >= ssthresh之后，进入到拥塞避免状态，cwnd一次加1，若出现超时，则让ssthresh = cwnd/2，再重新执行慢开始(cwnd = 1)。
       2. 快重传和快恢复：接收方在接收到数据报时，表示有序报文的最后一个，则只发送已经接收到的最后一个有序报文段，会多次发送同一个确认窗口信号。发送方若多次收到多个一样的窗口确认信号，则知道下一个报文多丢失，此时执行快重传，立即重传下一个有序报文段。此时因为表示因为网络拥塞造成的丢失，所以执行快恢复，令ssthresh = cwnd/2，cwnd = ssthresh，注意此时cwnd对于阈值，所以直接进入到拥塞避免状态。
   
5. 应用层：
  1. 各个应用层协议的常用端口：
     |                  |            |         |            |                             |
     | :--------------: | :--------: | :-----: | :--------: | :-------------------------: |
     |       应用       | 应用层协议 | 端口号  | 传输层协议 |            备注             |
     |     域名解析     |    DNS     |   53    |  UDP/TCP   | 长度超过 512 字节时使用 TCP |
     | 动态主机配置协议 |    DHCP    |  67/68  |    UDP     |                             |
     | 简单网络管理协议 |    SNMP    | 161/162 |    UDP     |                             |
     |   文件传送协议   |    FTP     |  20/21  |    TCP     |  控制连接 21，数据连接 20   |
     |   远程终端协议   |   TELNET   |   23    |    TCP     |                             |
     |  超文本传送协议  |    HTTP    |   80    |    TCP     |                             |
     | 简单邮件传送协议 |    SMTP    |   25    |    TCP     |                             |
     |   邮件读取协议   |    POP3    |   110   |    TCP     |                             |
     | 网际报文存取协议 |    IMAP    |   143   |    TCP     |                             |
     
  2. 域名系统：DNS域名解析

     * DNS是一个分布式数据库，提供了主机名和IP地址之间的相互转换。一般使用UDP进行数据的传输，若返回的响应大于512字节，则会采用TCP进行数据传输。

  3. 文件传送协议：FTP协议使用TCP进行传输

     * 使用两个连接来传送一个文件
       * 控制连接：服务器打开端口号21等待客户端的连接，用于客户端向服务器发送控制指令，并接收服务器返回的应答
       * 数据连接：用来传送一个文件的文件数据。
     * 根据数据连接是否是有服务端主动建立的，FTP有主动模式和被动模式两种模式
     * SFTP安全文件传送协议：基本原理和FTP一致，但是在其基础上在文件传输时使用了一种安全的加密方式。其本身是SSH的一部分。因为需要加密，所以传输速度稍逊与FTP，但是若考虑安全性问题，现在大多使用SFTP来进行文件传输。

  4. DHCP动态主机配置协议：其使用户不需要手动配置IP地址等信息。包括IP地址，子网掩码，网关IP地址等。

  5. 远程登录协议TELENT：用于登录到远程主机上，并可以适应许多计算机和操作系统的差异。

  6. 电子邮件协议：邮件系统包括用户代理，邮件服务器和邮件协议。邮件协议中发送协议常使用SMTP，读取协议常使用POP3和IMAP。

     1. SMTP：只能发送ASCII码，但是记过MIME扩充协议可以发送二进制文件。
     2. POP3：只要用户从服务器上读取了邮件，就把邮件删除(也可以不删除)
     3. IMAP：只要用户不删除邮件，客户端的和服务器的邮件就会保持同步，一直保留

### Web页面请求过程

 	1. 若主机没有IP地址，则会先通过DHCP协议来配置主机信息IP地址，子网掩码，DNS服务器和网关等。
 	2. ARP解析MAC地址，解析得到DNS服务器所在的网关路由器的MAC地址。
 	3. DNS解析域名，有网关路由器发送域名信息等到DNS服务器，DNS数据库进过查询得到IP地址，并将IP信息数据报通过路由器反向转发到网关路由器，再进过以太交换机达到主机。
 	4. HTTP请求页面，主机找到HTTP服务器的IP地址后，就可以生成TCP套接字，通过套集字向Web服务器发送HTTP GET等请求报文。
     * 在生成套接字前会进行三次握手来建立连接，端口号为80的HTTP端口
     * 建立连接之后，浏览器生成HTTP GET报文，并将报文发给HTTP服务器
     * HTTP服务器从套接字中提取出请求报文，并通过解析得到HTTP响应报文，将Web页面内容放入到报文主体中，发送给主机。
     * 浏览器收到响应报文之后，会提取其中的主体内容并进行渲染。

